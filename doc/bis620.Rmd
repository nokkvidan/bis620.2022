---
title: "bis620"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{bis620}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(bis620.2022)

# Load the data
data(diabetes)

# Splitting the dataset for train and test
set.seed(1)
sample <- sample(c(1, 2), nrow(diabetes), replace = TRUE, prob = c(.8, .2))
train <- diabetes[sample == 1, ]
test <- diabetes[sample == 2, ]
```

# Motivations

It is estimated that 1 in 10 people in America have diabetes and 1 in 5 of those with the health condition have not been clinically diagnosed [1]. Type 1 diabetes occurs when the body is unable to produce insulin and is inherited from their family, but type 2 diabetes occurs when the body is unable to use insulin properly and can be prevented or delayed with improvements to a patient's lifestyle. 

Our goal is to identify what kinds of health indicators might be linked with Type 2 diabetes and pre-diabetes.

By using this project, healthcare professionals will be able to quickly determine the likelihood of a patient's susceptibility to diabetes, allowing for earlier detection and providing guidelines to inform lifestyle changes and treatments. This can ultimately improve individual patient outcomes and reduce the overall proportion of diabetes in the population.

Additionally, this project can help researchers study the significant correlation between specific health indicators and the likelihood of developing diabetes. By using the functions provided in this project, researchers can quickly analyze the relationship between different variables and diabetes, potentially uncovering new insights into the causes and risk factors of the condition.

To accomplish this goal, we developed this diabetes risk prediction R package which helps facilitate the analysis of health indicators such as age, BMI, and sex. Through a number of machine learning algorithms we can analyze a large Kaggle data set of patients with known diabetes status and health indicators [2]. Theses algorithms use a combination of continuous and categorical variables to create a model that can predict the likelihood of a patient having diabetes. The following models are available in this package as functions: generalized linear model, XGBoost and random forests. These functions also include additional options for optimization and evaluation.

The data set `diabetes` has been attached to the package and is available to use as demonstrated with the examples below.

## EDA

The diabetes risk prediction R project also includes a suite of visualization functions that allow for the exploratory analysis of the data set used to train the prediction model. These functions provide an interactive and intuitive way to explore the relationship between different variables and the likelihood of a patient having diabetes.

#### Visualize interactions (2 variables)

Using the function `vis_2vars()` we can visualize the interaction of any two variables in the data set. The function determines what type the variables are and then produces a plot accordingly. The options are bar-, violin-, and scatter plots depending on the kinds of variables that are put into the function.

```{r vis2, warnings = FALSE, fig.width=7, fig.height=7}
# Factor v continuous produces a violin plot
# Continuous v factor also produces a violin plot
p1 <- vis_2vars(diabetes, "Diabetes_binary", "BMI")
# Continuous v continuous produces a scatter plot
p2 <- vis_2vars(diabetes, "MentHlth", "BMI")
# Factor v factor produces a side by side bar plot
p3 <- vis_2vars(diabetes, "Diabetes_binary", "Sex")
p4 <- vis_2vars(diabetes, "Age", "Diabetes_binary")
gridExtra::grid.arrange(p1, p2, p3, p4)
```

#### Visualise numeric variables

Using the function `vis_num()` we can get an overview of the numeric variables in our data set and how they could potentially used if scaled to the same scale of $[0,1]$. Thus, this function visualizes all the non-categorical variables in the data set with boxplots.

```{r visnum, fig.width=7}
p5 <- vis_num(diabetes)
```

#### Visualise distributions of numeric variables

Using the function `vis_dist()` we see more detailed distribution plots of the numeric variables that we want to investigate. The plot includes a qqplot and a histogram of the numeric variables in the data set provided.

From the plot above we might want to consider visualizing `BMI` and `MentHlth` as they are a bit skewed. We also add `Sex` into the parameters to show that function properly removes factor variables.

```{r visdist, fig.width=7, fig.height = 6}
df_dist <- diabetes[, c("BMI", "MentHlth", "Sex")]
vis_dist(df_dist)
```

#### Summary of EDA functions

Overall, these visualization functions provide a powerful tool for the exploration and analysis of the data set, and can help researchers gain a better understanding of the factors that influence the likelihood of a patient having diabetes.

## Modeling and Evaluation

The R package allows health care professionals to easily model and evaluate generalized linear models (GLM), XGBoost, and random forests for identifying significant variables correlated with diabetes. With these functions, users can quickly fit these models to their data and assess the performance of each model to determine the best approach for their specific use case. To be able to evaluate the performance one must split the data set into training and test sets (shown above).

In addition, the package offers a range of evaluation metrics and visualization tools to help users interpret the results of the model and make informed decisions about the factors associated with diabetes. Overall, the functions provide a convenient and user-friendly solution for health care professionals looking to use machine learning methods to analyze diabetes data.

```{r}
# Fit a GLM to the diabetes data
glm_fit0 <- glm_model("Diabetes_binary", diabetes)
# Fit a random forest model to the diabetes data
rf_fit0 <- rf_model("Diabetes_binary", diabetes)
# Fit an XGBoost model to the diabetes data
xg_fit0 <- boost_model("Diabetes_binary", diabetes)
```

``` {r}
# Fit and evaluate the performance of the GLM model
glm_fit <- glm_model("Diabetes_binary", train, test, optimize = "manual")
# Fit and evaluate the performance of the random forest model
rf_fit <- rf_model("Diabetes_binary", train, test, optimize = TRUE)
# Fit and evaluate the performance of the XGBoost model
xg_fit <- boost_model("Diabetes_binary", train, test)
```

# Results

